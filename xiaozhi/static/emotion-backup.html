<!DOCTYPE html>
<html>
<head>
    <title>XiaoZhi Emotion Display</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            overflow: hidden;
        }
        
        .emotion-container {
            font-size: 30vw;
            text-align: center;
            user-select: none;
        }
        
        .emotion {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="emotion-container">
        <div id="emotion" class="emotion">ğŸ˜</div>
    </div>

    <script>
        let ws;
        
        function connect() {
            ws = new WebSocket(`ws://${window.location.host}/ws`);
            
            ws.onopen = function(event) {
                console.log("Connected to WebSocket");
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log("æ”¶åˆ°æ¶ˆæ¯:", data);
                handleServerMessage(data);
            };
            
            ws.onclose = function(event) {
                console.log("WebSocket connection closed");
                // å°è¯•é‡æ–°è¿æ¥
                setTimeout(connect, 3000);
            };
            
            ws.onerror = function(error) {
                console.log("WebSocket error: " + error);
            };
        }
        
        function handleServerMessage(message) {
            console.log("å¤„ç†æ¶ˆæ¯:", message);
            // æ ¹æ®æƒ…ç»ªçŠ¶æ€æ˜¾ç¤ºä¸åŒçš„è¡¨æƒ…
            // å½“æ¥æ”¶åˆ° emotion_update ç±»å‹çš„æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°è¡¨æƒ…æ˜¾ç¤º
            if (message.type === 'emotion_update') {
                const emotionElement = document.getElementById('emotion');
                // æ ¹æ®æƒ…ç»ªçŠ¶æ€æ˜¾ç¤ºä¸åŒçš„è¡¨æƒ…
                switch(message.data.emotion) {
                    case 'happy':
                        // é«˜å…´æ—¶æ˜¾ç¤ºç¬‘è„¸è¡¨æƒ…
                        emotionElement.textContent = 'ğŸ˜Š';
                        break;
                    case 'sad':
                        // ä¼¤å¿ƒæ—¶æ˜¾ç¤ºå“­è„¸è¡¨æƒ…
                        emotionElement.textContent = 'ğŸ˜¢';
                        break;
                    case 'angry':
                        // ç”Ÿæ°”æ—¶æ˜¾ç¤ºæ„¤æ€’è¡¨æƒ…
                        emotionElement.textContent = 'ğŸ˜ ';
                        break;
                    case 'surprised':
                        // æƒŠè®¶æ—¶æ˜¾ç¤ºæƒŠè®¶è¡¨æƒ…
                        emotionElement.textContent = 'ğŸ˜²';
                        break;
                    case 'neutral':
                        // ä¸­æ€§/é»˜è®¤çŠ¶æ€æ—¶æ˜¾ç¤ºé»˜è®¤è¡¨æƒ…
                        emotionElement.textContent = 'ğŸ˜';
                        break;
                    default:
                        // å…¶ä»–æœªå®šä¹‰çš„æƒ…ç»ªçŠ¶æ€æ˜¾ç¤ºé»˜è®¤è¡¨æƒ…
                        emotionElement.textContent = 'ğŸ˜';
                }
            }
        }
        
        // åˆå§‹åŒ–WebSocketè¿æ¥
        connect();
    </script>
</body>
</html>