<!DOCTYPE html>
<html>
<head>
    <title>XiaoZhi Emotion Display</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #000;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .emotion-container {
            font-size: 30vw;
            text-align: center;
            user-select: none;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .emotion {
            transition: all 0.3s ease;
        }
        
        .chat-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
        }
        
        #user-input {
            flex-grow: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: #333;
            color: white;
            font-size: 16px;
        }
        
        #send-button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        
        #send-button:hover {
            background-color: #0056b3;
        }
        
        .output-area {
            margin-top: 20px;
        }
        
        #model-output {
            background-color: #333;
            border-radius: 5px;
            padding: 15px;
            min-height: 100px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .output-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="emotion-container">
        <div id="emotion" class="emotion">ğŸ˜</div>
    </div>
    
    <div class="chat-container">
        <div class="input-area">
            <input type="text" id="user-input" placeholder="è¯·è¾“å…¥æ‚¨çš„æ¶ˆæ¯..." />
            <button id="send-button">å‘é€</button>
        </div>
        
        <div class="output-area">
            <div class="output-label">æ¨¡å‹è¾“å‡º:</div>
            <div id="model-output"></div>
        </div>
    </div>

    <script>
        let ws;
        
        function connect() {
            ws = new WebSocket(`ws://${window.location.host}/ws`);
            
            ws.onopen = function(event) {
                console.log("Connected to WebSocket");
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                console.log("æ”¶åˆ°æ¶ˆæ¯:", data);
                handleServerMessage(data);
            };
            
            ws.onclose = function(event) {
                console.log("WebSocket connection closed");
                // å°è¯•é‡æ–°è¿æ¥
                setTimeout(connect, 3000);
            };
            
            ws.onerror = function(error) {
                console.log("WebSocket error: " + error);
            };
        }
        
        function handleServerMessage(message) {
            console.log("å¤„ç†æ¶ˆæ¯:", message);
            // æ ¹æ®æƒ…ç»ªçŠ¶æ€æ˜¾ç¤ºä¸åŒçš„è¡¨æƒ…
            // å½“æ¥æ”¶åˆ° emotion_update ç±»å‹çš„æ¶ˆæ¯æ—¶ï¼Œæ›´æ–°è¡¨æƒ…æ˜¾ç¤º
            if (message.type === 'emotion_update') {
                const emotionElement = document.getElementById('emotion');
                // æ ¹æ®æƒ…ç»ªçŠ¶æ€æ˜¾ç¤ºä¸åŒçš„è¡¨æƒ…
                switch(message.data.emotion) {
                    case 'happy':
                        // é«˜å…´æ—¶æ˜¾ç¤ºç¬‘è„¸è¡¨æƒ…
                        // éšæœºé€‰æ‹©ä¸€ä¸ªé«˜å…´çš„è¡¨æƒ…
                        const happyEmojis = ['ğŸ˜Š', 'ğŸ˜„', 'ğŸ˜ƒ', 'ğŸ˜€', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'â˜ºï¸', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©'];
                        emotionElement.textContent = happyEmojis[Math.floor(Math.random() * happyEmojis.length)];
                        break;
                    case 'sad':
                        // ä¼¤å¿ƒæ—¶æ˜¾ç¤ºå“­è„¸è¡¨æƒ…
                        // éšæœºé€‰æ‹©ä¸€ä¸ªä¼¤å¿ƒçš„è¡¨æƒ…
                        const sadEmojis = ['ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜', 'ğŸ˜”', 'ğŸ˜Ÿ', 'ğŸ˜•', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜£', 'ğŸ˜–', 'ğŸ˜«', 'ğŸ˜©', 'ğŸ¥º', 'ğŸ˜¢', 'ğŸ˜­'];
                        emotionElement.textContent = sadEmojis[Math.floor(Math.random() * sadEmojis.length)];
                        break;
                    case 'angry':
                        // ç”Ÿæ°”æ—¶æ˜¾ç¤ºæ„¤æ€’è¡¨æƒ…
                        // éšæœºé€‰æ‹©ä¸€ä¸ªæ„¤æ€’çš„è¡¨æƒ…
                        const angryEmojis = ['ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ˜¤', 'ğŸ’¢', 'ğŸ˜ ', 'ğŸ‘¿', 'ğŸ’€', 'ğŸ”¥'];
                        emotionElement.textContent = angryEmojis[Math.floor(Math.random() * angryEmojis.length)];
                        break;
                    case 'surprised':
                        // æƒŠè®¶æ—¶æ˜¾ç¤ºæƒŠè®¶è¡¨æƒ…
                        // éšæœºé€‰æ‹©ä¸€ä¸ªæƒŠè®¶çš„è¡¨æƒ…
                        const surprisedEmojis = ['ğŸ˜²', 'ğŸ˜±', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜µ', 'ğŸ¤¯', 'ğŸ™€', 'ğŸ˜²'];
                        emotionElement.textContent = surprisedEmojis[Math.floor(Math.random() * surprisedEmojis.length)];
                        break;
                    case 'neutral':
                        // ä¸­æ€§/é»˜è®¤çŠ¶æ€æ—¶æ˜¾ç¤ºé»˜è®¤è¡¨æƒ…
                        // éšæœºé€‰æ‹©ä¸€ä¸ªä¸­æ€§çš„è¡¨æƒ…
                        const neutralEmojis = ['ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ˜’', 'ğŸ™„', 'ğŸ¤”', 'ğŸ«¤', 'ğŸ˜', 'ğŸ˜‘'];
                        emotionElement.textContent = neutralEmojis[Math.floor(Math.random() * neutralEmojis.length)];
                        break;
                    default:
                        // å…¶ä»–æœªå®šä¹‰çš„æƒ…ç»ªçŠ¶æ€æ˜¾ç¤ºé»˜è®¤è¡¨æƒ…
                        console.warn(`æœªå®šä¹‰çš„æƒ…ç»ªçŠ¶æ€: ${message.data.emotion}ï¼Œä½¿ç”¨é»˜è®¤è¡¨æƒ…`);
                        emotionElement.textContent = 'ğŸ˜';
                }
            } else if (message.type === 'text_update') {
                // å¤„ç†æ¨¡å‹è¾“å‡ºæ–‡æœ¬æ›´æ–°
                const outputElement = document.getElementById('model-output');
                outputElement.textContent = message.data.text;
            }
        }
        
        // å‘é€ç”¨æˆ·è¾“å…¥åˆ°æœåŠ¡å™¨
        function sendUserInput() {
            const inputElement = document.getElementById('user-input');
            const text = inputElement.value.trim();
            
            if (text && ws && ws.readyState === WebSocket.OPEN) {
                const message = {
                    action: "send_text",
                    payload: {
                        text: text
                    }
                };
                
                ws.send(JSON.stringify(message));
                inputElement.value = '';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šå‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.getElementById('send-button').addEventListener('click', sendUserInput);
            
            // ç»‘å®šå›è½¦é”®å‘é€
            document.getElementById('user-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendUserInput();
                }
            });
        });
        
        // åˆå§‹åŒ–WebSocketè¿æ¥
        connect();
    </script>
</body>
</html>